# Data Access Object (DAO) Annotation Processor

The annotation processor is designed to automate the creation of room persistence
style Data Access Objects (DAOs) and database classes for use on different platforms
(including Android via the Room Persistence Framework, JDBC, and GWT).

## Using the annotation processor
Put shared database and DAO classes in any Java module. Then setup the
gradle build files as required. The annotation processor has the following
options:
* umdb_room_out : the source directory to put generated room persistence
framework for Android. If using only a single implementation with a single
module, this can be "filer" to save output to the annotation processor
default directory.
* umdb_jdbc_out : the source directory to put generated JDBC output in.
If using only a single implementation with a single
module, this can be "filer" to save output to the annotation processor
default directory.
* umdb_no_default_factory : if present and set to true (default false),
no default factory implementation will be generated. This is needed in
the case of using a single module with only one implementation.

In the core module containing databases and DAOs:
```
compileJava {
    options.compilerArgs += [
        "-Aumdb_room_out=" + rootProject.file("android-module-name/build/generated/source/umdbprocessor").getAbsolutePath(),
        "-Aumdb_jdbc_out=" + rootProject.file("javase-module-name/build/generated/source/umdbprocessor").getAbsolutePath(),
        "-Aumdb_no_default_factory=false"
    ]
}

jar {
    exclude("db/class/package/*_Factory.*")
}


```

In the modules using generated implementations:

```
sourceSets {
    main.java.srcDirs += ["build/generated/source/umdbprocessor"]
}
```

## JDBC Testing

The generated JDBC implementation uses the standard JNDI/Datasource lookup
process. For testing purposes, we use simple-jndi. Any modules using the
JDBC implementation must provide a JNDI datasource. This can be done by
including simple-jndi. Jndi.properties must be in the resources path of
the module, and this should contain a datasource (this is done using
the jndi-config directory for tests).

## Debugging the annotation processor using IntelliJ

In gradle.properties, uncomment the lines:
```
#org.gradle.daemon=true
#org.gradle.jvmargs=-Xmx3072m -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5006
```

In IntelliJ select Run, Debug..., Add a remote configuration, and 
enter the por as per org.gradle.jvmargs (e.g. 5006)

## Known Issues

The JDBC implementation of list insert may not return all autogenerated primary keys, 
due the underlying implementation of getGeneratedKeys.


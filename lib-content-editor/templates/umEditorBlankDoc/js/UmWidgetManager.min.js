let UmWidgetManager=function(widget){this.widget=widget};UmWidgetManager._locale={};const editableSectionsSelector=".question-body, .extra-content, .question-choice-body , .question-choice-feedback , .question-choice-feedback-correct , .question-choice-feedback-wrong";let currentWidgetType=null;UmWidgetManager.QUESTION_ID_TAG="id-question-",UmWidgetManager.CHOICE_ID_TAG="id-choice-",UmWidgetManager.EXTRA_CONTENT_ID_TAG="id-",UmWidgetManager._widgets={},UmWidgetManager._locale={},UmWidgetManager._widgetListeners={},UmWidgetManager.isNewWidget=!1,UmWidgetManager.isEditingMode=!1,UmWidgetManager.WIDGET_NAME_MULTICHOICE="multi-choice",UmWidgetManager.WIDGET_NAME_FILL_BLANKS="fill-the-blanks",UmWidgetManager.WIDGET_NAME_EXTRA_CONTENT="extra-content",UmWidgetManager.CLIPBOARD_CONTENT=null,UmWidgetManager.PAGE_BREAK='<p style="page-break-before: always" class="pg-break">',UmWidgetManager.EXTRA_CONTENT_WIDGET='<div data-um-widget="extra-content" class="um-row um-editable default-margin-top extra-content"><p></p></div>'+UmWidgetManager.PAGE_BREAK;let UmMultipleChoiceWidget=function(widget){UmWidgetManager.apply(this,arguments)},UmFillTheBlanksWidget=function(widget){UmWidgetManager.apply(this,arguments)},UmExtraContentWidget=function(widget){UmWidgetManager.apply(this,arguments)};UmMultipleChoiceWidget.prototype=Object.create(UmWidgetManager.prototype),UmFillTheBlanksWidget.prototype=Object.create(UmWidgetManager.prototype),UmExtraContentWidget.prototype=Object.create(UmWidgetManager.prototype),UmWidgetManager.loadPlaceHolderByLanguageCode=((langCode,testEnv=!1)=>{if(UmWidgetManager.prototype.isEmpty(UmWidgetManager._locale)){const localeFileUrl=(testEnv?"/":"")+localeDir+"locale."+langCode+".json";$.ajax({url:localeFileUrl,success:fileContent=>{UmWidgetManager._locale=fileContent},error:()=>{"en"!==locale&&UmWidgetManager.loadPlaceholders("en",testEnv)}})}}),UmWidgetManager.handleWidgetNode=((widgetNode,newWidget=!1)=>{const questionId=$(widgetNode).attr("id");if(UmWidgetManager.isNewWidget=newWidget,!UmWidgetManager._widgets[questionId])switch(currentWidgetType=$(widgetNode).attr("data-um-widget")){case UmWidgetManager.WIDGET_NAME_MULTICHOICE:UmWidgetManager._widgets[questionId]=new UmMultipleChoiceWidget(widgetNode);break;case UmWidgetManager.WIDGET_NAME_FILL_BLANKS:UmWidgetManager._widgets[questionId]=new UmFillTheBlanksWidget(widgetNode);break;case UmWidgetManager.WIDGET_NAME_EXTRA_CONTENT:UmWidgetManager._widgets[questionId]=new UmExtraContentWidget(widgetNode)}return UmWidgetManager._widgets[questionId]}),UmWidgetManager.handleWidgetListeners=((editMode=!1)=>{const umBody=$("body");umBody.off("click").off("change").off("Paste"),umBody.on("click",event=>{editMode?($(event.target).hasClass("action-delete")&&UmWidgetManager.prototype.onQuestionDeletion(event),$(event.target).hasClass("action-delete-inner")&&UmWidgetManager.prototype.onQuestionChoiceDeletion(event),$(event.target).hasClass("action-cut")&&UmWidgetManager.prototype.onQuestionCut(event),$(event.target).hasClass("add-choice")&&UmMultipleChoiceWidget.prototype.addChoice(event)):($(event.target).hasClass("qn-retry")&&UmWidgetManager.prototype.onQuestionRetryButtonClicked(event),$(event.target).hasClass("fill-the-blanks-check")&&(UmWidgetManager.isEditingMode||UmFillTheBlanksWidget.prototype.onQuestionAnswerChecked(event)),($(event.target).hasClass("question-choice")||$(event.target).hasClass("question-choice-body")||$($(event.target).parent()).hasClass("question-choice-body"))&&(UmWidgetManager.isEditingMode||UmMultipleChoiceWidget.prototype.onQuestionAnswerChecked(event)))}),umBody.on("change",event=>{editMode&&($(event.target).hasClass("question-choice-answer-select")?UmMultipleChoiceWidget.prototype.onChoiceStateChange(event):$(event.target).hasClass("question-retry-option-select")&&UmWidgetManager.prototype.onQuestionRetrySelectionChange(event))})}),UmWidgetManager.handleEditableContent=((editEnabled=!0)=>{const editableElement=$(".um-editor").find(editableSectionsSelector);editEnabled?$(editableElement).addClass("um-editable"):$(editableElement).removeClass("um-editable")}),UmWidgetManager.prototype.switchEditingModeOn=function(){currentWidgetType!=UmWidgetManager.WIDGET_NAME_EXTRA_CONTENT&&($(this.widget).find("label , br").remove(),$(this.widget).find(".question-body").removeClass("default-margin-bottom").before("<label class='um-labels' style='z-index: 3;'>"+UmWidgetManager._locale.placeholders.labelForQuestionBodyText+"</label><br/>"),$(this.widget).find(".question-retry-btn").html("<button class='float-right qn-retry extra-btn' data-um-preview='support'>"+UmWidgetManager._locale.placeholders.labelForTryAgainOptionBtn+"</button>"),$(this.widget).find(".question").removeClass("default-padding").addClass("default-padding-top default-padding-bottom"),$(this.widget).find(".question-answer").removeClass("show-element").addClass("hide-element"),$(this.widget).find(".question-action-holder, .action-inner").removeClass("hide-element").addClass("show-element"),UmWidgetManager.isNewWidget?UmWidgetManager.prototype.handleNewWidget(this.widget):UmWidgetManager.prototype.handleExistingWidget(this.widget),$(this.widget).find(".question-retry-option").html("<select class='question-retry-option-select'>  <option value=\"true\">"+UmWidgetManager._locale.placeholders.labelForTrueOptionText+'</option>  <option value="false" selected="selected">'+UmWidgetManager._locale.placeholders.labelFalseOptionText+"</option></select>"),$(this.widget).find(".question-retry-option").before("<label class='um-labels no-left-padding'>"+UmWidgetManager._locale.placeholders.labelForQuestionRetryOption+"</label><br/>"),$(this.widget).find('div[class^="question"], .extra-content').each((index,widget)=>{$(widget).attr("id")||$(widget).attr("id",UmWidgetManager.EXTRA_CONTENT_ID_TAG+UmWidgetManager.getNextUniqueId())})),UmWidgetManager.handleEditableContent(!0),UmWidgetManager.handleWidgetListeners(!0)},UmMultipleChoiceWidget.prototype.switchEditingModeOn=function(){return UmWidgetManager.prototype.switchEditingModeOn.apply(this,arguments),UmWidgetManager.prototype.handleWidgetChoice(this.widget),$(this.widget).find("label").css("z-index","1"),$(this.widget).find(".action-delete-inner").removeClass("hide-element").addClass("show-element"),this.widget},UmFillTheBlanksWidget.prototype.switchEditingModeOn=function(){return UmWidgetManager.prototype.switchEditingModeOn.apply(this,arguments),$(this.widget).find(".fill-blanks").removeClass("hide-element").addClass("show-element"),$(this.widget).find(".question-choice-body").before("<label class='um-labels'>"+UmWidgetManager._locale.placeholders.labelForFillTheBlanksAnswerBodyText+"</label>"),$(this.widget).find(".input-group").before("<label class='um-labels '>"+UmWidgetManager._locale.placeholders.labelForFillTheBlanksPromptInput+"</label>"),$(this.widget).find(".question-choice-feedback-correct").before("<label class='um-labels'>"+UmWidgetManager._locale.placeholders.labelForQuestionRightFeedbackText+"</label>"),$(this.widget).find(".question-choice-feedback-wrong").before("<label class='um-labels'>"+UmWidgetManager._locale.placeholders.labelForQuestionWrongFeedbackText+"</label>"),this.widget},UmExtraContentWidget.prototype.switchEditingModeOn=function(){return UmWidgetManager.prototype.switchEditingModeOn.apply(this,arguments),$(this.widget).removeClass("hide-element").addClass("show-element"),this.widget},UmWidgetManager.prototype.handleNewWidget=(widget=>{const choiceOrAnswerLabel=$(widget).attr("data-um-widget")===UmWidgetManager.WIDGET_NAME_MULTICHOICE?UmWidgetManager._locale.placeholders.placeholderForTheChoiceText:UmWidgetManager._locale.placeholders.placeholderForTheAnswerText;$(widget).find(".question-body").html("<p>"+UmWidgetManager._locale.placeholders.placeholderForTheQuestionText+"</p>"),$(widget).find(".question-choice-body").html("<p>"+choiceOrAnswerLabel+"</p>"),$(widget).find(".question-choice-feedback").html("<p>"+UmWidgetManager._locale.placeholders.placeholderForTheChoiceFeedback+"</p>"),$(widget).find(".question-choice-feedback-correct").html("<p>"+UmWidgetManager._locale.placeholders.placeholderForTheRightChoiceFeedback+"</p>"),$(widget).find(".question-choice-feedback-wrong").html("<p>"+UmWidgetManager._locale.placeholders.placeholderForTheWrongChoiceFeedback+"</p>"),$(widget).find(".fill-the-blanks-check").text(UmWidgetManager._locale.placeholders.labelForCheckAnswerInputPromptBtn),$(widget).find(".fill-the-blanks-input").attr("placeholder",UmWidgetManager._locale.placeholders.placeholderForTheBlanksInput)}),UmWidgetManager.prototype.handleExistingWidget=(widget=>{$(widget).find(".question-choice").removeClass("question-choice-pointer no-padding choice-no-margin-top selected-choice alert alert-secondary").addClass("default-margin-top"),$(widget).find('[data-um-preview="main"]').removeClass("preview-main default-margin-top"),$(widget).find('[data-um-preview="alert"]').removeClass("preview-alert default-margin-top"),$(widget).find('[data-um-preview="support"]').removeClass("preview-support default-margin-top"),$(widget).find(".default-theme").addClass("no-padding"),$(widget).find(".question-feedback-container").addClass("hide-element").removeClass("show-element"),$(widget).removeClass("um-card default-margin-bottom default-padding-top"),$(widget).find(".multi-choice").removeClass("default-margin-top").addClass("default-margin-bottom"),$(widget).find(".question-answer").removeClass("default-margin-bottom"),$(widget).find("p.pg-break, .question-choice-answer , .question-choice-feedback,.fill-blanks,.select-option , .question-action-holder").removeClass("hide-element").addClass("show-element")}),UmWidgetManager.prototype.handleWidgetChoice=(widget=>{$(widget).find(".question-add-choice").removeClass("hide-element").addClass("show-element").html("<button class='float-right dont-remove add-choice default-margin-top extra-btn'>"+UmWidgetManager._locale.placeholders.labelForAddChoiceBtn+"</button>"),$(widget).find(".question-choice-body").before("<label class='um-labels'>"+UmWidgetManager._locale.placeholders.labelForChoiceBodyText+"</label>"),$(widget).find(".question-choice-feedback").before("<label class='um-labels'>"+UmWidgetManager._locale.placeholders.labelForFeedbackBodyText+"</label>"),$(widget).find(".question-choice-answer").before("<label class='um-labels'>"+UmWidgetManager._locale.placeholders.labelForRightAnswerOption+"</label>"),$(widget).find(".question-choice-answer").html("<select class='question-choice-answer-select'>  <option value=\"true\">"+UmWidgetManager._locale.placeholders.labelForTrueOptionText+'</option>  <option value="false" selected="selected">'+UmWidgetManager._locale.placeholders.labelFalseOptionText+"</option></select>")}),UmMultipleChoiceWidget.prototype.addChoice=function(event,testEnv=!1){const choiceTemplateUrl=(testEnv?"/":"")+questionTemplatesDir+"template-qn-choice.html";$.ajax({url:choiceTemplateUrl,success:choice=>{choice=$(choice).attr("id",UmWidgetManager.EXTRA_CONTENT_ID_TAG+UmWidgetManager.getNextUniqueId()),UmWidgetManager.prototype.handleNewWidget(choice),UmWidgetManager.prototype.handleWidgetChoice(choice);let questionElement=$($(event.target).closest("div .question")).children();(questionElement=$(questionElement.get(questionElement.length-4))).after(choice),UmWidgetManager.handleEditableContent(!0),UmWidgetManager.handleWidgetListeners(!0),UmEditorCore.requestFocusFromElementWithId(choice)}})},UmMultipleChoiceWidget.prototype.onQuestionAnswerChecked=function(event){const choiceElement=$(event.target).closest("div .question-choice"),questionElement=$(event.target).closest("div div.question"),allChoices=$(questionElement).find("[data-um-correct]");for(let choice in allChoices){if(!allChoices.hasOwnProperty(choice))continue;const choiceNode=allChoices[choice];if($(choiceNode).hasClass("question-choice-pointer")){$(choiceNode).attr("id")===$(choiceElement).attr("id")?$(choiceNode).addClass("selected-choice"):$(choiceNode).removeClass("selected-choice")}}const isCorrectChoice="true"===choiceElement.attr("data-um-correct"),feedbackText=$(choiceElement).find(".question-choice-feedback").html(),feedbackContainer=$(questionElement).find(".question-feedback-container");$(feedbackContainer).find(".question-feedback-container-text").html(feedbackText),$(feedbackContainer).removeClass("hide-element show-element alert-success alert-danger alert-warning"),$(feedbackContainer).addClass((isCorrectChoice?"alert-success":"alert-danger")+" show-element");const canBeRetried="true"===questionElement.attr("data-um-retry");!isCorrectChoice&&canBeRetried&&$(questionElement).find(".question-retry-btn").removeClass("hide-element").addClass("show-element"),isCorrectChoice&&$(questionElement).find(".question-retry-btn").removeClass("show-element").addClass("hide-element")},UmWidgetManager.removeSpaces=(value=>value.replace(/(\r\n|\n|\r)/gm,"").replace(/\s/g,"")),UmFillTheBlanksWidget.prototype.onQuestionAnswerChecked=(event=>{const questionElement=$(event.target).closest("div div.question"),choiceElement=$(questionElement).find(".fill-blanks"),wrongChoiceText=$(choiceElement).find(".question-choice-feedback-wrong").html(),correctChoiceText=$(choiceElement).find(".question-choice-feedback-correct").html();let defaultAnswerText=$(choiceElement).find(".question-choice-body").text().toLowerCase(),userAnswerText=$(questionElement).find(".fill-the-blanks-input").val().toLowerCase();const feedbackContainer=$(questionElement).find(".question-feedback-container");userAnswerText=UmWidgetManager.removeSpaces(userAnswerText);const isCorrectChoice=(defaultAnswerText=UmWidgetManager.removeSpaces(defaultAnswerText))===userAnswerText,message=isCorrectChoice?correctChoiceText:wrongChoiceText;$(feedbackContainer).find(".question-feedback-container-text").html(message),$(feedbackContainer).removeClass("hide-element show-element alert-success alert-danger alert-warning alert-info"),$(feedbackContainer).addClass((isCorrectChoice?"alert-success":"alert-danger")+" show-element");const canBeRetried="true"===questionElement.attr("data-um-retry");(!isCorrectChoice&&canBeRetried||userAnswerText.length<=0)&&$(questionElement).find(".question-retry-btn").removeClass("hide-element").addClass("show-element"),isCorrectChoice&&$(questionElement).find(".question-retry-btn").removeClass("show-element").addClass("hide-element")}),UmMultipleChoiceWidget.prototype.onChoiceStateChange=(event=>{$(event.target).closest("div .question-choice").attr("data-um-correct",$(event.target).val())}),UmWidgetManager.prototype.onQuestionRetrySelectionChange=(event=>{const questionElement=$(event.target).closest("div div.question"),canBeRetried="true"===$(event.target).val();$(questionElement).attr("data-um-retry",canBeRetried),$(this.widget).find("br").remove()}),UmWidgetManager.prototype.onQuestionRetryButtonClicked=(event=>{const questionElement=$(event.target).closest("div.question");$(questionElement).find(".question-choice-pointer").removeClass("selected-choice"),$(questionElement).find(".question-feedback-container").removeClass("show-element").addClass("hide-element"),$(questionElement).find(".question-retry-btn").removeClass("show-element").addClass("hide-element")}),UmWidgetManager.prototype.onQuestionDeletion=(event=>{isDeleteOrCutAction=!0;const questionElement=$(event.target).closest("div div.question"),extraOrEmptyContent=$(questionElement).next(),innerParagraph=$(extraOrEmptyContent).children().get(0);0===UmWidgetManager.removeSpaces($(innerParagraph).text()).length&&$(extraOrEmptyContent).remove(),$(questionElement).remove(),setTimeout(()=>{isDeleteOrCutAction=!1},averageEventTimeout)}),UmWidgetManager.prototype.onQuestionChoiceDeletion=(event=>{isDeleteOrCutAction=!0;const questionChoice=$(event.target).closest("div div.question-choice");$(questionChoice).remove(),setTimeout(()=>{isDeleteOrCutAction=!1},averageEventTimeout)}),UmWidgetManager.prototype.onQuestionCut=(event=>{isDeleteOrCutAction=!0;let questionElement=$(event.target).closest("div div.question");$(questionElement).select(),questionElement=questionElement.get(0).outerHTML,UmWidgetManager.prototype.onQuestionDeletion(event);const clipboardContent=JSON.stringify({action:"onContentCut",content:UmEditorCore.base64Encode(questionElement)});setTimeout(()=>{isDeleteOrCutAction=!1},averageEventTimeout);try{UmContentEditor.onContentCut(clipboardContent)}catch(e){UmEditorCore.prototype.logUtil("onContentCut:",e)}}),UmWidgetManager.prototype.isExtraContentEmpty=(content=>{let contentData="";return $(content).children().each((index,childElement)=>{$(childElement).is("p")?contentData+=$(childElement).html().replace("&nbsp;",""):contentData=$(childElement)[0].nodeName}),contentData.length<=0}),UmWidgetManager.prototype.isEmpty=(obj=>{for(let key in obj)if(obj.hasOwnProperty(key))return!1;return!0}),UmWidgetManager.getNextUniqueId=((idLength=16)=>{const chars="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_";let questionId="";for(let i=idLength;i>0;--i)questionId+=chars[Math.floor(Math.random()*chars.length)];return questionId}),UmWidgetManager.preparingPreview=(content=>{let umdocument=$("<div/>").html(content);return $(umdocument).find("br").remove(),$(umdocument).find("label").remove(),$(umdocument).find(".mce-content-body, .um-editable").removeClass("mce-content-body mce-edit-focus um-editable"),$(umdocument).find(".pg-break").remove(),$(umdocument).find(".add-choice").remove(),$(umdocument).find(".question-choice").addClass("um-alert alert-secondary choice-no-margin-top question-choice-pointer").removeClass("default-margin-top"),$(umdocument).find(".multi-choice").addClass("default-margin-bottom").removeClass("default-margin-top"),$(umdocument).find(".default-theme").removeClass("no-padding"),$(umdocument).find(".question-body").addClass("default-margin-bottom no-left-padding"),$(umdocument).find(".question-answer").addClass("no-padding no-left-padding default-margin-bottom"),$(umdocument).find(".fill-answer-inputs").addClass("no-padding"),$(umdocument).find('[data-um-preview="main"]').addClass("preview-main default-margin-top"),$(umdocument).find('[contenteditable="true"]').removeAttr("contenteditable").removeAttr("spellcheck"),$(umdocument).find('[data-um-preview="alert"]').addClass("preview-alert default-margin-top"),$(umdocument).find('[data-um-preview="support"]').addClass("preview-support default-margin-top"),$(umdocument).find(".question").removeClass("um-editable default-padding-top default-padding-bottom").addClass("um-card default-padding"),$(umdocument).find(".select-option , .fill-blanks, .question-choice-answer, .question-retry-btn, .question-choice-feedback , .pg-break, .action-delete-inner, .question-add-choice, .question-action-holder").removeClass("show-element").addClass("hide-element"),$(umdocument).find(".question-answer").removeClass("hide-element").addClass("show-element"),$(umdocument).find(".extra-content").each((index,widget)=>{UmWidgetManager.prototype.isExtraContentEmpty(widget)&&$(widget).removeClass("show-element").addClass("hide-element")}),umdocument=$("<div/>").html(umdocument).contents().html()});

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login  Ustad Mobile Cloud Django</title>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="materialize.min.css">
    <style type="text/css">
		#exercise table{
			display: block !important;
			overflow-x: auto !important;
		}
		img {
			max-width: 100%;
			height: auto;
		}
		@font-face {
			font-family: "droid arabic naskh";
			src: url("DroidNaskh-Regular.woff2") format("woff2");
			font-weight: normal;
		}

		@font-face {
			font-family: "droid arabic naskh";
			src: url("DroidNaskh-Bold.woff2") format("woff2");
			font-weight: bold;
		}

		p {
			font-family: "droid arabic naskh",sans-serif;
		}
		h4{
			font-family: "droid arabic naskh",serif;
		}
	</style>

</head>

<body onload="readJson();">
<script type="text/javascript">

			var jsonQuestions = null;
			var questionsCounter = 0;
			var hintsCounter = 0;

			function readJson() {
                var request = new XMLHttpRequest();
                request.open("GET", "questions.json", false);
                request.send(null);
                jsonQuestions = JSON.parse(request.responseText);

                displayQuestion(questionsCounter);
            }

            function displayQuestion(counter){


                var submit = document.getElementById("correctAnswer");
                submit.setAttribute("class","waves-effect waves-light btn");

                hintsCounter = 0;

                document.getElementById("question").innerHTML=jsonQuestions[counter].full_description;

                var container = document.getElementById("choices");
                var next = document.getElementById("nextquestion");
                var explain = document.getElementById("explaination");
                var hints = document.getElementById("hints");
                next.style.display = "none";
                explain.innerHTML = "";
                container.innerHTML = "";
                hints.innerHTML = "";

                var hintsList = jsonQuestions[counter].hints;
                var hintButton = document.getElementById("hintbtn");
                if(hintsList.length === 0){
                    hintButton.setAttribute("class","btn disabled");
                }else{
                    hintButton.setAttribute("class","waves-effect waves-light btn");
                }

				if(jsonQuestions[questionsCounter].component_type === "NumericResponseQuestion"){

                    var text = document.createElement("input");
                    text.setAttribute("class","right-align");
                    text.setAttribute("id","edittext");
                    text.setAttribute("type", "text");
                    text.setAttribute("placeholder","أجب هنا");

                    container.appendChild(text);
                    linebreak = document.createElement("br");
                    container.appendChild(linebreak);

			}else if (jsonQuestions[questionsCounter].component_type === "MultipleChoiceQuestion"){

				    var form = document.createElement("form");
				    form.setAttribute("action","#");

                    for(var i = 0; i < jsonQuestions[counter].choices.length ; i++){

						var para = document.createElement("p");

                        var input = document.createElement("input");
                        input.setAttribute("type","radio");
                        input.setAttribute("class","with-gap");
                        input.setAttribute("name","choice");
                        input.setAttribute("id","choice" + i);

                        var label = document.createElement("label");
                        label.setAttribute("for","choice" + i);
                        label.setAttribute("display","inline-block");
                        label.innerHTML = jsonQuestions[counter].choices[i].description;

                        para.appendChild(input);
                        para.appendChild(label);
                        form.appendChild(para);
                    }
                    container.appendChild(form);
				}


            }

            function formatAnswer(answer){
                return answer.replace(/^0+/, '').replace(/\.0+$/,'');
            }

            function incorrectAnswer() {
                var explainationDiv = document.getElementById("explaination");

                if(explainationDiv.hasChildNodes()) {

                    while (explainationDiv.hasChildNodes()) {
                        explainationDiv.removeChild(explainationDiv.lastChild);
                    }
                }
                var wrong =  document.createElement("h5");
                wrong.setAttribute("class","right-align red-text");
                wrong.textContent = "حاول مرة أخرى";

                explainationDiv.appendChild(wrong);

            }

            function correctAnswer() {

			    var submit = document.getElementById("correctAnswer");
			    submit.setAttribute("class","btn disabled");

                var next = document.getElementById("nextquestion");
                next.style.display = "block";

                var explainationDiv = document.getElementById("explaination");

                if(explainationDiv.hasChildNodes()) {
                    while (explainationDiv.hasChildNodes()) {
                        explainationDiv.removeChild(explainationDiv.lastChild);
                    }
                }

                var correct =  document.createElement("h5");
                correct.setAttribute("class","right-align green-text");
				correct.textContent = "أحسنت! إجابتك صحيحة.";

                explainationDiv.appendChild(correct);

                var text = document.createElement("h5");
                text.setAttribute("class","right-align");
                text.textContent = "الشرح";

                explainationDiv.appendChild(text);

                var message = document.createElement("p");
                message.innerHTML = jsonQuestions[questionsCounter].explanation;
                explainationDiv.appendChild(message);

            }

            function displayHints(counter){

			    var hints = jsonQuestions[questionsCounter].hints;

               	var divContent = document.getElementById("hints");

				var hintTitle = document.createElement("h5");
				hintTitle.setAttribute("class","right-align green-text");

				hintTitle.textContent = " تلميح " + (counter+1) + " / " + hints.length;

				var hintMessage = document.createElement("h6");
				hintMessage.setAttribute("class","right-align");

				hintMessage.innerHTML = hints[counter].description;

				divContent.appendChild(hintTitle);
				divContent.appendChild(hintMessage);

				hintsCounter++;
				if(hintsCounter === hints.length){
                    var hintButton = document.getElementById("hintbtn");
                    hintButton.setAttribute("class","btn disabled");
				}


			}
            function submitAnswer() {

                if (jsonQuestions[questionsCounter].component_type === "NumericResponseQuestion") {

                    var edittext = formatAnswer(document.getElementById("edittext").value);
                    if (edittext == formatAnswer(jsonQuestions[questionsCounter].correct_answer_precise)) {
                        correctAnswer();
                    } else {
                        incorrectAnswer();
                    }

                } else if (jsonQuestions[questionsCounter].component_type === "MultipleChoiceQuestion") {

                    var radios = document.getElementsByName("choice");

                    for (var i = 0; i < jsonQuestions[questionsCounter].choices.length; i++) {

                        if (radios[i].checked) {
                            if (jsonQuestions[questionsCounter].choices[i].is_correct) {
                                correctAnswer();
                            } else {
                                incorrectAnswer();
                            }

                            break;
                        }
                    }
                }
            }


            function hideVideoOnError(){
			    document.getElementById("video").style.display = "none";
			}

	  </script>
<div id="header">
    <p></p>
</div>
<div id="page" role="main" class="container"  style="align-content:center;">

    <video id="video" width="100%" height="auto" controls>
        <source src="video.mp4" type="video/mp4" onerror="hideVideoOnError()">
    </video>

    <div id="exercise">
        <h4 id="question"></h4>
        <div id="choices"></div>
        <div id="hints" class="row"></div>
        <div class="row" id="explaination"></div>
        <div class="row">
            <button  class="waves-effect waves-light btn" style="float:right" id="hintbtn" onclick="displayHints(hintsCounter)">هل تحتاج إلى تلميح؟
            </button>
            <button  class="waves-effect waves-light btn" id="correctAnswer" onclick=submitAnswer();>تحقق من إجابتي</button><br/>
        </div>
        <div class="row">
            <button  class="waves-effect waves-light btn" id="nextquestion" style=display:none onclick="displayQuestion(++questionsCounter)">السؤال التالي</button>
        </div>
    </div>
</div>

<script src="jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="materialize.min.js"></script>
</body>
</html>
